const h=t=>document.getElementById(t),w=(t,e,n)=>t.style[e]=n,S=(t,e,n)=>t.setAttribute(e,n),V=(t,e)=>t.classList.contains(e),i=(t,e)=>{V(t,e)||t.classList.add(e)},m=(t,e)=>{V(t,e)&&t.classList.remove(e)},x=(t,e)=>{e.parentNode===t&&t.removeChild(e)},rt=t=>{for(;t.hasChildNodes();)t.removeChild(t.lastChild)},C=(t,e,n)=>{w(t,"left",e+"px"),w(t,"top",n+"px")},d=(t,e)=>Math.floor(Math.random()*e)+t,A=(t,e,n)=>{const o=d(t,e);return o===n?A(t,e,n):o},E=t=>{const e=0-window.innerWidth*.2,n=0-window.innerWidth*.1,o=0,s=window.innerHeight,a=window.innerWidth*1.1,l=window.innerWidth*1.2,c=0,g=window.innerHeight,u=0,p=window.innerWidth,O=0-window.innerHeight*.2,ot=0-window.innerHeight*.1,B=0,st=window.innerWidth,R=window.innerHeight*1.1,at=window.innerHeight*1.2;let N=Math.floor(Math.random()*4+1);t&&(N=t);let b=0,T=0;switch(N){case 1:b=Math.floor(Math.random()*(n-e+1))+e,T=Math.floor(Math.random()*(s-o))+o;break;case 2:b=Math.floor(Math.random()*(l-a+1))+a,T=Math.floor(Math.random()*(g-c))+c;break;case 3:b=Math.floor(Math.random()*(p-u+1))+u,T=Math.floor(Math.random()*(ot-O))+O;break;case 4:b=Math.floor(Math.random()*(st-B+1))+B,T=Math.floor(Math.random()*(at-R))+R;break}return{x:b,y:T}},L=h("letter-pool"),W=h("temp-letter-pool"),k=h("letter-overlay");h("chat-message-column-wrapper");const it=h("chat-message-column"),I=h("message-input"),v=h("message-input-field"),U=h("chat-bot-mood"),lt=h("chat-bot-mood-value"),r={isUserSendingMessage:!1,isChatBotSendingMessage:!1,letterPool:{transitionPeriod:3e4,intervals:[]},moods:["friendly","suspicious","boastful"],currentMood:"",chatbotMessageIndex:0,nLetterSets:4},dt=()=>{const t=d(1,3);return r.moods[t-1]},j=()=>{r.currentMood=dt();for(let t=0;t<r.moods.length;t++)m(U,r.moods[t]);i(U,r.currentMood),lt.innerHTML=r.currentMood},ct=()=>{let t=0;switch(r.currentMood){case"friendly":return t=d(1,y.friendly.length),y.friendly[t-1];case"suspicious":return t=d(1,y.suspicious.length),y.suspicious[t-1];case"boastful":return t=d(1,y.boastful.length),y.boastful[t-1]}},ut=()=>{let t=0;switch(r.currentMood){case"friendly":return t=d(1,M.friendly.length),M.friendly[t-1];case"suspicious":return t=d(1,M.suspicious.length),M.suspicious[t-1];case"boastful":return t=d(1,M.boastful.length),M.boastful[t-1]}},H=(t,e)=>{const n=document.createElement("div");return i(n,t),S(n,"data-letter",e),n.innerHTML=e,n},Y=t=>{let e=[];for(let o=65;o<=90;o++){let s=String.fromCharCode(o),a=null;t||(s=s.toLowerCase()),console.log("getAlphabet",s),a=H("pool-letter",s),e.push(a)}const n=[{country:"中国",language:"中文",translation:"你好"},{country:"美国",language:"英语",translation:"Hello"},{country:"加拿大",language:"英语",translation:"Hello"},{country:"日本",language:"日语",translation:"こんにちは"},{country:"韩国",language:"韩语",translation:"안녕하세요"},{country:"德国",language:"德语",translation:"Hallo"},{country:"法国",language:"法语",translation:"Bonjour"},{country:"意大利",language:"意大利语",translation:"Ciao"},{country:"西班牙",language:"西班牙语",translation:"Hola"},{country:"俄罗斯",language:"俄语",translation:"Здравствуйте"},{country:"印度",language:"印地语",translation:"नमस्ते"},{country:"巴西",language:"葡萄牙语",translation:"Olá"},{country:"墨西哥",language:"西班牙语",translation:"Hola"},{country:"阿拉伯联合酋长国",language:"阿拉伯语",translation:"مرحبا"},{country:"南非",language:"南非荷兰语",translation:"Hallo"}];return e=[],n.forEach(o=>{const{translation:s}=o,a=H("pool-letter",s);e.push(a)}),e},z=(t,e,n)=>{clearInterval(n),e=A(1,4,e);let o=E(e),s=r.letterPool.transitionPeriod,a=d(0,r.letterPool.transitionPeriod),l=`left ${s}ms linear ${a}ms, top ${s}ms linear ${a}ms, opacity 0.5s`;C(t,o.x,o.y),w(t,"transition",l),n=setInterval(()=>{z(t,e,n)},r.letterPool.transitionPeriod+a),r.letterPool.intervals.push(n)},X=t=>{for(let e=0;e<t.length;e++){let n=t[e],o=d(1,4),s=A(1,4,o),a=E(o),l=E(s),c=r.letterPool.transitionPeriod,g=d(0,r.letterPool.transitionPeriod)*-1,u=`left ${c}ms linear ${g}ms, top ${c}ms linear ${g}ms, opacity 0.5s`;C(n,a.x,a.y),w(n,"transition",u),i(n,"invisible"),L.appendChild(n),setTimeout(()=>{C(n,l.x,l.y),m(n,"invisible");let p=setInterval(()=>{z(n,s,p)},r.letterPool.transitionPeriod+g)},1)}},ht=(t=1)=>{for(let e=0;e<t;e++){const n=Y(!1),o=Y(!0);X(n),X(o)}},J=()=>{rt(L)},gt=(t,e)=>{for(let n=0;n<e.length;n++){const o=document.createElement("span");o.innerHTML=e[n],S(o,"data-letter",e[n]),t.appendChild(o)}},mt=(t,e)=>{let n=document.createElement("div"),o=document.createElement("div"),s=document.createElement("i"),a=document.createElement("div"),l=document.createElement("h1"),c=e?"received":"sent";return i(a,"content"),i(a,"invisible"),i(l,"text"),i(l,"invisible"),gt(l,t),a.appendChild(l),i(o,"profile-icon"),i(o,"invisible"),o.appendChild(s),i(n,"message"),i(n,c),e?(i(s,"fab"),i(s,"fa-cloudsmith"),i(n,r.currentMood),n.appendChild(o),n.appendChild(a)):(i(s,"far"),i(s,"fa-user"),n.appendChild(a),n.appendChild(o)),n},ft=t=>{let e=L.childNodes,n=null;for(let o=0;o<e.length;o++){const s=e[o];if(s.dataset.letter===t&&!s.dataset.found){n=e[o],S(n,"data-found",!0);break}}return n},pt=t=>{const e=document.createElement("span");return i(e,"overlay-letter"),i(e,"in-flight"),e.innerHTML=t,e},yt=t=>{i(t,"invisible"),setTimeout(()=>{x(L,t)},500)},$=(t,e,n)=>{w(t,"right",e+"px"),w(t,"top",n+"px")},G=(t,e,n,o)=>{yt(t);const s=t.getBoundingClientRect(),a=pt(t.dataset.letter);o?C(a,s.left,s.top):$(a,window.innerWidth-s.right,s.top),k.appendChild(a),setTimeout(()=>{o?C(a,n.left,n.top):$(a,window.innerWidth-n.right,n.top),setTimeout(()=>{m(e,"invisible"),i(a,"invisible"),setTimeout(()=>{x(k,a)},1e3)},1500)},100)},Mt=(t,e)=>{const n=t.getElementsByClassName("content")[0],o=n.getElementsByClassName("text")[0],s=o.childNodes;o.getBoundingClientRect();for(let a=0;a<s.length;a++){const l=s[a],c=ft(l.dataset.letter),g=l.getBoundingClientRect();if(c)G(c,o,g,e);else{const u=H("temp-letter",l.dataset.letter),p=E();i(u,"invisible"),C(u,p.x,p.y),W.appendChild(u),G(u,o,g,e),setTimeout(()=>{x(W,u)},100)}}},q=(t,e)=>{const n=mt(t,e),o=n.getElementsByClassName("content")[0];o.getElementsByClassName("text")[0];const s=n.getElementsByClassName("profile-icon")[0];it.appendChild(n),f(),setTimeout(()=>{m(s,"invisible"),setTimeout(()=>{m(o,"invisible"),setTimeout(()=>{Mt(n,e)},1e3)},250)},250)},K=()=>v.value.length>0,wt=()=>{v.value=""},Ct=()=>r.chatbotMessageIndex===0?ct():ut(),Z=()=>{const t=Ct();r.isChatBotSendingMessage=!0,q(t,!0),r.chatbotMessageIndex++,setTimeout(()=>{r.isChatBotSendingMessage=!1,f()},1e3)},vt=()=>{const t=v.value;r.isUserSendingMessage=!0,q(t,!1),setTimeout(()=>{r.isUserSendingMessage=!1,f()},1e3)},bt=t=>{vt(),setTimeout(()=>{Z()},1e3),f(),wt()},Q=()=>{J(),ht(r.nLetterSets)},Tt=()=>{j(),Q(),Z(),f(),nt(et()),P()};let F=null;const P=()=>{const t=r.letterPool.intervals;for(let e=0;e<t.length;e++)clearInterval(t[e]);clearTimeout(F),J(),F=setTimeout(()=>{Q()},200)},f=()=>{K()&&tt()?i(I,"send-enabled"):m(I,"send-enabled")},tt=()=>!r.isUserSendingMessage&&!r.isChatBotSendingMessage,et=()=>d(2e4,1e4);let D=null;const nt=t=>{D=setInterval(()=>{clearInterval(D),j(),nt(et())},t)};v.onkeypress=t=>{K()&&t.key==="Enter"&&(m(I,"send-enabled"),tt()&&bt())};v.onkeyup=()=>{f()};v.oncut=()=>f();window.onload=()=>Tt();window.onfocus=()=>P();window.onresize=_.throttle(P,200);const y={friendly:["你好吗","Good day to you, friend!"],suspicious:["Hmm, I would introduce myself, but I'm not so sure thats a good idea.","Hello, how are you? Wait, don't answer that, I have no way of verifying your response!"],boastful:["Hey, did I mention I am built on JavaScript? Which is the greatest language ever by the way!","Good day to you. Though I must say that I am having a GREAT day!"]},M={friendly:["你好.","Ahh, yes, I agree. It is so great to say things, isn't it?","Please, tell me more. It brings me such joy to respond to the things you say.","Ahh, yes valid point. Or was it? Either way, you're fantastic!","无论如何，我有没有提到过希望你今天过得愉快？如果没有，那我希望它会变得更好！"],suspicious:[],boastful:[]};P();
